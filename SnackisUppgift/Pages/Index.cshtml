@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<style>
    .card-img-container {
        height: 70vh;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

        .card-img-container img {
            object-fit: cover;
            width: 100%;
            height: 100%;
        }
</style>

<div class="text-center">
    @if (Model.MyUser != null)
    {
        <h1 class="display-4">Välkommen @Model.MyUser.FirstName @Model.MyUser.LastName</h1>
    }
</div>

@if (User.Identity.IsAuthenticated)
{
    <p>Du är ingloggad som @User.Identity.Name</p>
@*    <form method="post" asp-page-handler="ToggleForm">
        <input type="hidden" name="showForm" value="@Model.ShowForm" />
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-plus-circle"></i>
            @if (Model.ShowForm)
            {
                <span>Close form</span>
            }
            else
            {
                <span>Open form</span>
            }
        </button>
    </form>*@

    <div class="accordion" id="PostAccordion">
        <div class="card">
            <div class="card-header" id="Posta">
                <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#PostCollapse" aria-expanded="true" aria-controls="PostCollapse">
                    Post
                </button>
            </div>
            <div id="PostCollapse" class="collapse" aria-labelledby="Posta" data-bs-parent="#PostAccordion">
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        <div class="form-group">
                            <label asp-for="@Model.Post.Title" class="form-label"></label>
                            <input asp-for="Post.Title" class="form-control">
                            <span asp-validation-for="Post.Title" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Post.Description" class="form.label"></label>
                            <textarea asp-for="Post.Description" class="form-control" cols="40" rows="5"></textarea>
                            <span asp-validation-for="Post.Description" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Post.SubjectId" class="form-label"></label>
                            <select asp-for="Post.SubjectId" class="form-control" asp-items="@(new SelectList(Model.Subjects, "Id", "Category"))">
                                <option value="">Välj ämne</option>
                            </select>
                        </div>
                        <div class="form-group form-check">
                            <input asp-for="IsAnonymous" type="checkbox" class="form-check-input" id="anonymousCheck">
                            <label asp-for="IsAnonymous" class="form-check-label">Posta som anonym</label>
                        </div>

                        <div class="form-group">
                            <label asp-for="Post.Image" class="form-label"></label>
                            <input type="file" class="form-control" name="UploadedImage">
                        </div>

                        <input type="submit" class="btn btn-success" value="Spara Inlägg">
                    </form>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-danger">Du är INTE inloggad </div>
}

<div class="row">
    <div class="col-md-3">
        <div class="list-group">
            @foreach (var subject in Model.Subjects)
            {
                <a asp-route-subjectId="@subject.Id" class="list-group-item list-group-item-action">
                    @subject.Category
                </a>
            }
        </div>
    </div>
    <div class="col-md-9">
        <!-- Your post content here -->
    </div>
</div>

<div class="d-flex justify-content-center flex-wrap">
    @if (Model.Posts != null)
    {
        @foreach (var post in Model.Posts)
        {
            <div class="card m-2" style="width: 60vw; max-width: 100%;">
                <div class="card-img-container">
                    @if (!string.IsNullOrEmpty(post.Image))
                    {
                        <img class="card-img-top" src="~/img/@post.Image">
                    }
                    else
                    {
                        <p>No image available for this post</p>
                    }
                </div>

                <div class="card-body">
                    <div class="card-header-info d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            @if (Model.IsAnonymous != true)
                            {
                                <img src="@post.ProfilePicture" onerror="if (this.src != 'error.jpg') this.src = '/images/default_profile_picture.jpg';" alt="Profile picture" style="width:40px;height:40px;border-radius:50%;">
                            }
                            <p class="mb-0 ml-2">@(!Model.IsAnonymous && !string.IsNullOrEmpty(post.UserName) ? post.UserName : "Anonym")</p>
                        </div>
                        <p class="mb-0">@post.Date</p>
                    </div>

@*                    <div class="card-header-info d-flex justify-content-between align-items-center">
                        <p class="mb-0">@(!string.IsNullOrEmpty(post.PostedBy) ? post.PostedBy : "Anonym")</p>
                        <p class="mb-0">@post.Date</p>
                    </div>*@
                    <h5 class="card-title">@post.Title</h5>
                    <p class="card-text">@post.Description</p>
                    @if (User.Identity.Name != null && (User.Identity.Name == post.UserName || User.IsInRole("Admin")) || User.IsInRole("Owner"))
                    {
                        <a asp-route-deleteid="@post.Id" class="btn btn-primary">Ta bort</a>
                    }


                </div>
            </div>
        }
    }
</div>
